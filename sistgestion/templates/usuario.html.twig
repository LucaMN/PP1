{% extends 'principal.html.twig' %}
{% block stylesheets %}
    <!-- Enlace a la hoja de estilos personalizada para el formulario de inicio de sesión -->
    <link rel="stylesheet" href="http://localhost/PP1/SISTGESTION/assets/css/stylesUsuario.css">
{% endblock %}
{% block content %}
  {% block header %}
    {{ parent() }} {# Esto incluirá el contenido original del bloque header de principal.twig #}
 {% endblock %}
    <h2 class="nombre-usuario titulo_n_position"> Usuario </h2>
        <div class="img_titulo">
            <svg width="50" height="50" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M90.207 85.9375C89.9327 86.4127 89.5381 86.8072 89.0629 87.0815C88.5877 87.3558 88.0487 87.5001 87.5 87.5H12.5C11.9517 87.4994 11.4132 87.3546 10.9386 87.0801C10.464 86.8056 10.07 86.4111 9.79607 85.9361C9.52218 85.4612 9.37806 84.9225 9.3782 84.3742C9.37835 83.8259 9.52274 83.2873 9.79688 82.8125C15.7461 72.5274 24.9141 65.1524 35.6133 61.6563C30.321 58.5057 26.2092 53.705 23.9093 47.9914C21.6095 42.2778 21.2488 35.9672 22.8826 30.0287C24.5164 24.0903 28.0544 18.8523 32.9532 15.1192C37.8521 11.3862 43.8409 9.36438 50 9.36438C56.1591 9.36438 62.1479 11.3862 67.0468 15.1192C71.9456 18.8523 75.4836 24.0903 77.1174 30.0287C78.7512 35.9672 78.3905 42.2778 76.0907 47.9914C73.7908 53.705 69.679 58.5057 64.3867 61.6563C75.0859 65.1524 84.2539 72.5274 90.2031 82.8125C90.478 83.2872 90.6231 83.8259 90.6238 84.3745C90.6244 84.923 90.4807 85.4621 90.207 85.9375Z" fill="black"/>
            </svg>
         </div>

        <div class="datos-usuario1">
            <svg width="70" height="70" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_9_32)">
                <path d="M41.25 22.5C41.25 25.4837 40.0647 28.3452 37.955 30.455C35.8452 32.5647 32.9837 33.75 30 33.75C27.0163 33.75 24.1548 32.5647 22.045 30.455C19.9353 28.3452 18.75 25.4837 18.75 22.5C18.75 19.5163 19.9353 16.6548 22.045 14.545C24.1548 12.4353 27.0163 11.25 30 11.25C32.9837 11.25 35.8452 12.4353 37.955 14.545C40.0647 16.6548 41.25 19.5163 41.25 22.5Z" fill="black"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 30C0 22.0435 3.16071 14.4129 8.7868 8.7868C14.4129 3.16071 22.0435 0 30 0C37.9565 0 45.5871 3.16071 51.2132 8.7868C56.8393 14.4129 60 22.0435 60 30C60 37.9565 56.8393 45.5871 51.2132 51.2132C45.5871 56.8393 37.9565 60 30 60C22.0435 60 14.4129 56.8393 8.7868 51.2132C3.16071 45.5871 0 37.9565 0 30ZM30 3.75C25.0567 3.75026 20.2139 5.14636 16.029 7.7776C11.8441 10.4088 8.48731 14.1683 6.34487 18.6232C4.20242 23.0782 3.36145 28.0475 3.91874 32.9593C4.47604 37.8712 6.40895 42.5258 9.495 46.3875C12.1575 42.0975 18.0188 37.5 30 37.5C41.9813 37.5 47.8388 42.0938 50.505 46.3875C53.5911 42.5258 55.524 37.8712 56.0813 32.9593C56.6386 28.0475 55.7976 23.0782 53.6551 18.6232C51.5127 14.1683 48.1559 10.4088 43.971 7.7776C39.7861 5.14636 34.9433 3.75026 30 3.75Z" fill="black"/>
                </g>
                <defs>
                <clipPath id="clip0_9_32">
                <rect width="60" height="60" fill="white"/>
                </clipPath>
                </defs>
            </svg>
            {% if app.user %}
                <div class="usuario-info1">
                    <div class="nombre-apellido">
                    <span class="nombre-usuario-aut1">{{ app.user.nombre }}</span>
                    <span class="apellido-usuario-aut1">{{ app.user.apellido }}</span>
                    </div>
                </div>
                
                <div class="usuario-info-email1">
                    <span class="email-usuario-aut">{{ app.user.email }}</span>
                </div>
            {% endif %}
            <button><a href="{{ path('logout') }}"> Cerrar Sesión </button>
        </div>

        <nav class="opciones-usuario-cont">
            <ul>
                <li>
                    <div >
                        <img class="imagen-password" src="images/contrasena.svg">
                        <a class="titulo-contr"> Contraseña </a>
                        <div id="cambio-contrasena-form-container">
                            <form action="{{ path('cambiar_contrasena') }}" method="post">
                    <div>
                <li>
            <ul>
            <div class="actual-contr">
            <label for="current_password">Contraseña Actual:</label>
            </div>
            <div class="inputActualContr">
            <input type="password" id="current_password" name="current_password" required>
            </div>
            {% if error_mensaje_password is defined %}
               <div class="mensaje-error-password">{{ error_mensaje_password }}</div>
            {% endif %}
        </>
        
        <div>
            <div class="nueva-contr">
                <label for="new_password">Nueva Contraseña:</label>
            </div>
            <div class="inputNuevaContr">
            <input type="password" id="new_password" name="new_password" required>
            </div>
            {% if error_mensaje_password1 is defined %}
               <div class="mensaje-error-password">{{ error_mensaje_password1 }}</div>
            {% endif %}
            {% if mensaje_password is defined %}
                <div class="mensaje-exito-password">{{ mensaje_password }}</div>
            {% endif %}
        </div>
        <button class="boton-cambiar-contr" type="submit">Cambiar Contraseña</button>
    </form>
                <li>
                    <div>
                        <img class="imagen-correo" src="images/email.svg">
                        <a class="titulo-email"> Email </a>
                        <div id="cambio-email-form-container">
                            
                            <form action="{{ path('cambiar_email') }}" method="post">
                                <div class="nuevo-email">
                                    <label for="new_email">Nuevo Email:</label>
                                </div>
                                <div class="inputNuevoEmail">
                                <input type="email" id="new_email" name="new_email" required>
                                </div>
                                {% if mensaje_error_email is defined %}
                                    <div class="mensaje-error-email">{{ mensaje_error_email }}</div>
                                {% endif %}
                                {% if mensaje_email is defined %}
                                    <div class="mensaje-exito-email">{{ mensaje_email }}</div>
                                {% endif %}
                                <button class="boton-cambiar-email" type="submit">Cambiar Email</button>
                            </form>
                        </div>
                    </div>
                </li>
                <li>
                    <div>
                        <img class="imagen-usuario" src="images/nombre-usuario.svg">
                        <a class="titulo-usuario"> Cambiar nombre de usuario </a>
                        <div id="cambio-nombre-form-container">
    <form id="cambio-nombre-form" action="{{ path('cambiar_nombre_usuario') }}" method="post">
        <div>
            <div class="nuevo-usuario-nombre">
            <label for="new_nombre">Nuevo Nombre:</label>
            </div>
            <div class="inputNuevoUsuarioNombre">
            <input type="text" id="new_nombre" name="new_nombre" required>
            </div>
        </div>
        <div>
            <div class="nuevo-usuario-apellido">
            <label for="new_apellido">Nuevo Apellido:</label>
            </div>
            <div class="inputNuevoUsuarioApellido">
            <input type="text" id="new_apellido" name="new_apellido" required>
            </div>
            
        </div>
        {% if error_mensaje_apellido is defined %}
               <div class="mensaje-error-nombre-usuario">{{ error_mensaje_apellido }}</div>
            {% endif %}
            {% if error_mensaje_nombre is defined %}
               <div class="mensaje-error-nombre-usuario">{{ error_mensaje_nombre }}</div>
            {% endif %}
            {% if mensaje_nombre_usuario is defined %}
               <div class="mensaje-exito-nombre-usuario">{{ mensaje_nombre_usuario }}</div>
            {% endif %}

        <!-- Botón para enviar el formulario -->
        <button class="boton-cambiar-nombre-usuario" type="submit">Cambiar Nombre de Usuario</button>
    </form>
</div>
                    </div>
                </li>
            </ul>
        </nav>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Manejador de evento para el formulario de cambio de contraseña
                document.getElementById('cambio-contrasena-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    var currentPassword = document.getElementById('current_password').value;
                    var newPassword = document.getElementById('new_password').value;
                    enviarDatos('{{ path('cambiar_contrasena') }}', 'current_password=' + encodeURIComponent(currentPassword) + '&new_password=' + encodeURIComponent(newPassword));
                });

                // Manejador de evento para el formulario de cambio de email
                document.getElementById('cambio-email-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    var newEmail = document.getElementById('new_email').value;
                    enviarDatos('/cambiar-email', 'new_email=' + encodeURIComponent(newEmail));
                });

                document.getElementById('cambio-nombre-form').addEventListener('submit', function(event) {
                    event.preventDefault();
                    var newNombre = document.getElementById('new_nombre').value;
                    var newApellido = document.getElementById('new_apellido').value;
                    enviarDatos('{{ path('cambiar_nombre_usuario') }}', 'new_nombre=' + encodeURIComponent(newNombre) + '&new_apellido=' + encodeURIComponent(newApellido));
                });

                // Función para enviar los datos al servidor
                function enviarDatos(url, data) {
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', url, true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.onload = function() {
                        if (xhr.status === 200) {
                            alert(xhr.responseText);
                        } else {
                            alert('Error al procesar la solicitud. Inténtalo de nuevo.');
                        }
                    };
                    xhr.send(data);
                }
            });
        </script>
{% endblock %}
